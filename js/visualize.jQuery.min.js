(function(b){b.fn.visualize=function(G,y){return b(this).each(function(){var c=b.extend({type:"bar",width:b(this).width(),height:b(this).height(),appendTitle:true,title:null,appendKey:true,colors:["#be1e2d","#666699","#92d5ea","#ee8310","#8d10ee","#5a3b16","#26a4ed","#f45a90","#e9e744"],textColors:[],parseDirection:"x",pieMargin:20,pieLabelPos:"inside",lineWeight:4,barGroupMargin:10,barMargin:1,yLabelInterval:30,pieRemainder:1},G);c.width=parseFloat(c.width);c.height=parseFloat(c.height);if(c.pieRemainder!=
1)c.colors[c.pieRemainder-1]=b(this).css("backgroundColor");var p=b(this),D={pie:function(){r.addClass("visualize-pie");c.pieLabelPos=="outside"&&r.addClass("visualize-pie-outside");var j=Math.round(h.height()/2),m=j-c.pieMargin-50,a=m+c.pieMargin,f=0,i=b('<ul class="visualize-labels"></ul>').insertAfter(h);b.each(H,function(d){var g=this<=0||isNaN(this)?0:this/I;e.beginPath();e.moveTo(a,j);e.arc(a,j,m,f*Math.PI*2-Math.PI*0.5,(f+g)*Math.PI*2-Math.PI*0.5,false);e.lineTo(a,j);e.closePath();e.fillStyle=
n[d].color;e.fill();var k=f+g/2,l=c.pieLabelPos=="inside"?m/1.5:m+m/5,s=Math.round(a+Math.sin(k*Math.PI*2)*l);k=Math.round(j-Math.cos(k*Math.PI*2)*l);l=s>a?"right":"left";var t=k>j?"bottom":"top",o=b('<span class="visualize-label">'+Math.round(g*100)+"%</span>").css(l,0).css(t,0);b('<li class="visualize-label-pos'+(n[d].color==p.css("backgroundColor")?" visualize-hide-key":"")+'"></li>').appendTo(i).css({left:s,top:k}).append(o);o.css("margin-"+l,-o.width()/2).css("margin-"+t,-o.outerHeight()/2);
g<0.0090&&o.css("display","none");n[d].textColor&&o.css("color",n[d].textColor);f+=g})},line:function(j){j?r.addClass("visualize-area"):r.addClass("visualize-line");var m=h.width()/(w.length-1),a=b('<ul class="visualize-labels-x"></ul>').width(h.width()).height(h.height()).insertBefore(h);b.each(w,function(g){var k=b("<li><span>"+this+"</span></li>").prepend('<span class="line" />').css("left",m*g).appendTo(a).find("span:not(.line)"),l=k.width()/-2;if(g==0)l=0;else if(g==w.length-1)l=-k.width();k.css("margin-left",
l).addClass("label")});var f=h.height()/x,i=h.height()/(u.length-1),d=b('<ul class="visualize-labels-y"></ul>').width(h.width()).height(h.height()).insertBefore(h);b.each(u,function(g){var k=b("<li><span>"+this+"</span></li>").prepend('<span class="line"  />').css("bottom",i*g).prependTo(d).find("span:not(.line)"),l=k.height()/-2;if(g==0)l=-k.height();else if(g==u.length-1)l=0;k.css("margin-top",l).addClass("label")});e.translate(0,C);b.each(n,function(){e.beginPath();e.lineWidth=c.lineWeight;e.lineJoin=
"round";var g=this.points,k=0;e.moveTo(0,-(g[0]*f));b.each(g,function(){e.lineTo(k,-(this*f));k+=m});e.strokeStyle=this.color;e.stroke();if(j){e.lineTo(k,0);e.lineTo(0,0);e.closePath();e.fillStyle=this.color;e.globalAlpha=0.3;e.fill();e.globalAlpha=1}else e.closePath()})},area:function(){D.line(true)},bar:function(){r.addClass("visualize-bar");var j=h.width()/w.length,m=b('<ul class="visualize-labels-x"></ul>').width(h.width()).height(h.height()).insertBefore(h);b.each(w,function(o){b('<li><span class="label">'+
this+"</span></li>").prepend('<span class="line" />').css("left",j*o).width(j).appendTo(m).find("span.label").addClass("label")});var a=h.height()/x,f=h.height()/(u.length-1),i=b('<ul class="visualize-labels-y"></ul>').width(h.width()).height(h.height()).insertBefore(h);b.each(u,function(o){var z=b("<li><span>"+this+"</span></li>").prepend('<span class="line"  />').css("bottom",f*o).prependTo(i).find("span:not(.line)"),A=z.height()/-2;if(o==0)A=-z.height();else if(o==u.length-1)A=0;z.css("margin-top",
A).addClass("label")});e.translate(0,C);for(var d=0;d<n.length;d++){e.beginPath();var g=(j-c.barGroupMargin*2)/n.length;e.lineWidth=g-c.barMargin*2;for(var k=n[d].points,l=0,s=0;s<k.length;s++){var t=l-c.barGroupMargin+d*g+g/2;t+=c.barGroupMargin*2;e.moveTo(t,0);e.lineTo(t,Math.round(-k[s]*a));l+=j}e.strokeStyle=n[d].color;e.stroke();e.closePath()}}},v=document.createElement("canvas");v.setAttribute("height",c.height);v.setAttribute("width",c.width);var h=b(v);v=c.title||p.find("caption").text();
var r=(y||b('<div class="visualize" role="img" aria-label="Chart representing data from the table: '+v+'" />')).height(c.height).width(c.width).append(h),q=function(){var j=c.colors,m=c.textColors;return{dataGroups:function(){var a=[];if(c.parseDirection=="x")p.find("tr:gt(0)").each(function(d){a[d]={};a[d].points=[];a[d].color=j[d];if(m[d])a[d].textColor=m[d];b(this).find("td").each(function(){a[d].points.push(parseFloat(b(this).text()))})});else for(var f=p.find("tr:eq(1) td").size(),i=0;i<f;i++){a[i]=
{};a[i].points=[];a[i].color=j[i];if(m[i])a[i].textColor=m[i];p.find("tr:gt(0)").each(function(){a[i].points.push(b(this).find("td").eq(i).text()*1)})}return a},allData:function(){var a=[];b(this.dataGroups()).each(function(){a.push(this.points)});return a},dataSum:function(){var a=0,f=this.allData().join(",").split(",");b(f).each(function(){a+=parseFloat(this)});return a},topValue:function(){var a=0,f=this.allData().join(",").split(",");b(f).each(function(){if(parseFloat(this,10)>a)a=parseFloat(this)});
return a},bottomValue:function(){var a=0,f=this.allData().join(",").split(",");b(f).each(function(){if(this<a)a=parseFloat(this)});return a},memberTotals:function(){var a=[],f=this.dataGroups();b(f).each(function(i){var d=0;b(f[i].points).each(function(g){d+=f[i].points[g]});a.push(d)});return a},yTotals:function(){for(var a=[],f=this.dataGroups(),i=this.xLabels().length,d=0;d<i;d++){a[d]=[];var g=0;b(f).each(function(){a[d].push(this.points[d])});a[d].join(",").split(",");b(a[d]).each(function(){g+=
parseFloat(this)});a[d]=g}return a},topYtotal:function(){var a=0,f=this.yTotals().join(",").split(",");b(f).each(function(){if(parseFloat(this,10)>a)a=parseFloat(this)});return a},totalYRange:function(){return this.topValue()-this.bottomValue()},xLabels:function(){var a=[];c.parseDirection=="x"?p.find("tr:eq(0) th").each(function(){a.push(b(this).html())}):p.find("tr:gt(0) th").each(function(){a.push(b(this).html())});return a},yLabels:function(){var a=[];a.push(J);for(var f=Math.ceil(x/Math.round(c.height/
c.yLabelInterval))||1;a[a.length-1]<B-f;)a.push(a[a.length-1]+f);a.push(B);return a}}}(),n=q.dataGroups();q.allData();var I=q.dataSum(),B=q.topValue(),J=q.bottomValue(),H=q.memberTotals(),x=q.totalYRange(),C=c.height*(B/x),w=q.xLabels(),u=q.yLabels();if(c.appendTitle||c.appendKey)var E=b('<div class="visualize-info"></div>').appendTo(r);c.appendTitle&&b('<div class="visualize-title">'+v+"</div>").appendTo(E);if(c.appendKey){var F=b('<ul class="visualize-key"></ul>');p.find(c.parseDirection=="x"?"tr:gt(0) th":
"tr:eq(0) th").each(function(j){b("<li"+(n[j].color==p.css("backgroundColor")?' class="visualize-hide-key"':"")+'><span class="visualize-key-color" style="background: '+n[j].color+'"></span><span class="visualize-key-label'+(n[j].color==p.css("backgroundColor")?" visualize-hide-key":"")+'">'+b(this).text()+"</span></li>").appendTo(F)});F.appendTo(E)}y||r.insertAfter(this);typeof G_vmlCanvasManager!="undefined"&&G_vmlCanvasManager.initElement(h[0]);var e=h[0].getContext("2d");D[c.type]();b(".visualize-line li:first-child span.line, .visualize-line li:last-child span.line, .visualize-area li:first-child span.line, .visualize-area li:last-child span.line, .visualize-bar li:first-child span.line,.visualize-bar .visualize-labels-y li:last-child span.line").css("border",
"none");y||r.bind("visualizeRefresh",function(){p.visualize(c,b(this).empty())})}).next()}})(jQuery);